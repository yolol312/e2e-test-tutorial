# 테스트 교육/실습 시나리오(깨짐 유도 → 안전한 확장)

이 문서는 **의도적으로 “새 기능 추가로 인한 로직 회귀(regression)”**를 만들고,
Unit/E2E 테스트가 깨지는 상황을 통해 **안전하게 수정/확장하는 경험**을 주기 위한 가이드입니다.

## Unit 시나리오

현재는 **유닛 테스트를 사용하지 않는 방향**으로 운영합니다.
따라서 쿠폰/프로모션 기반의 유닛 테스트 시나리오 및 관련 코드는 제거되었습니다.

## E2E 시나리오: 로그인 → 담기 → 구매

대상 테스트:

- `e2e/auth-and-purchase.spec.ts`

### Stage 1: 현재(기본 플로우)

- 로그인(데모 계정) → 상품(1번) 장바구니 담기 → 구매 플로우를 검증합니다.
- 안정적인 셀렉터: `data-testid` 사용
  - 로그인: `login-email`, `login-password`, `login-submit`
  - 네비: `nav-cart`
  - 담기: `add-to-cart-1`
  - 장바구니: `cart-item`
  - 결제: `checkout-button`

### Stage 2: UI 기능 추가(의도)

#### 기능 A: 선택 구매(checkbox)

- “선택된 상품만 결제” 기능을 추가합니다.
- 흔한 사이드 이펙트:
  - UI는 선택 상태를 보여주는데 `totalPrice`/주문 items 생성은 전체 기준으로 그대로라 결제 금액이 어긋남

#### 기능 B: 자동 쿠폰 적용 토글

- (삭제됨) 쿠폰 로직 제거로 해당 시나리오는 사용하지 않습니다.

### Stage 3: 테스트 깨짐(버그 유도 예시)

- “선택 구매” 구현 중 `checkout()`에서 주문 items를 선택 상태로 필터링하지 않아 잘못된 주문 생성
- “자동 쿠폰” 구현 중 할인 계산 오류로 결제가 실패(구매 플로우 E2E가 깨짐)

## 운영 팁

- E2E는 반복 실행을 위해 테스트에서 `cartItems`/`orders`를 정리합니다.
- 새 기능 추가 시 **Unit(로직) → E2E(사용자 플로우)** 순으로 회귀를 확인하는 흐름을 권장합니다.
